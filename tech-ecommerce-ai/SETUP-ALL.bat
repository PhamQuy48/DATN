@echo off
chcp 65001 >nul
cls
echo.
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo โ                                                              โ
echo โ         SETUP Tแปฐ ฤแปNG - SHOP QM DATABASE                    โ
echo โ                                                              โ
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.
echo Bแบฏt ฤแบงu setup database tแปฑ ฤแปng...
echo.

REM Change to project directory
cd /d "%~dp0"

echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo  BฦฏแปC 1: KIแปM TRA XAMPP
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.

if not exist "C:\xampp" (
    echo [X] XAMPP chฦฐa ฤฦฐแปฃc cรi ฤแบทt!
    echo.
    echo Vui lรฒng cรi ฤแบทt XAMPP:
    echo 1. Tแบฃi vแป: https://www.apachefriends.org/download.html
    echo 2. Cรi ฤแบทt vรo: C:\xampp
    echo 3. Chแบกy lแบกi script nรy
    echo.
    pause
    exit /b 1
)
echo [โ] XAMPP ฤรฃ cรi ฤแบทt

echo.
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo  BฦฏแปC 2: KHแปI ฤแปNG MYSQL
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.

echo ฤang kiแปm tra MySQL...
C:\xampp\mysql\bin\mysql.exe -u root -e "SELECT 1;" >nul 2>&1

if %errorlevel% neq 0 (
    echo MySQL chฦฐa chแบกy. ฤang khแปi ฤแปng...
    echo.

    echo Vui lรฒng:
    echo 1. Mแป XAMPP Control Panel
    echo 2. Click "Start" bรชn cแบกnh MySQL
    echo 3. Chแป MySQL chแบกy (status mรu xanh)
    echo 4. Nhแบฅn Enter ฤแป tiแบฟp tแปฅc...
    echo.
    pause

    echo Kiแปm tra lแบกi...
    C:\xampp\mysql\bin\mysql.exe -u root -e "SELECT 1;" >nul 2>&1

    if %errorlevel% neq 0 (
        echo [X] MySQL vแบซn chฦฐa chแบกy!
        echo Vui lรฒng start MySQL vร chแบกy lแบกi script nรy
        pause
        exit /b 1
    )
)

echo [โ] MySQL ฤang chแบกy

echo.
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo  BฦฏแปC 3: TแบO DATABASE
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.

echo ฤang tแบกo database: shopqm_db...
C:\xampp\mysql\bin\mysql.exe -u root -e "CREATE DATABASE IF NOT EXISTS shopqm_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;" 2>nul

if %errorlevel% equ 0 (
    echo [โ] Database shopqm_db ฤรฃ tแบกo thรnh cรดng
) else (
    echo [X] Khรดng thแป tแบกo database
    pause
    exit /b 1
)

echo.
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo  BฦฏแปC 4: GENERATE PRISMA CLIENT
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.

call npx prisma generate
if %errorlevel% neq 0 (
    echo [X] Generate Prisma Client thแบฅt bแบกi
    pause
    exit /b 1
)

echo [โ] Prisma Client ฤรฃ generate

echo.
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo  BฦฏแปC 5: MIGRATE DATABASE
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.

echo ฤang tแบกo tables...
call npx prisma migrate dev --name init

if %errorlevel% neq 0 (
    echo.
    echo [!] Migration cรณ thแป ฤรฃ chแบกy rแปi hoแบทc cรณ lแปi
    echo Thแปญ push schema...
    call npx prisma db push
)

echo [โ] Migration hoรn tแบฅt

echo.
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo  BฦฏแปC 6: KIแปM TRA TABLES
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.

echo Cรกc tables ฤรฃ tแบกo:
C:\xampp\mysql\bin\mysql.exe -u root -D shopqm_db -e "SHOW TABLES;"

echo.
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo  HOรN TแบคT! โจ
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.
echo [โ] Database: shopqm_db
echo [โ] Connection String: mysql://root:@localhost:3306/shopqm_db
echo [โ] Tables: ฤรฃ tแบกo
echo [โ] Prisma Client: ฤรฃ generate
echo.
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo  TRUY CแบฌP DATABASE
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.
echo ๐ phpMyAdmin:
echo    URL: http://localhost/phpmyadmin
echo    Username: root
echo    Password: (ฤแป trแปng)
echo.
echo ๐จ Prisma Studio (Khuyแบฟn nghแป):
echo    Lแปnh: npx prisma studio
echo    URL: http://localhost:5555
echo.
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo  WEBSITE
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.
echo ๐ Website: http://localhost:3002
echo ๐จโ๐ผ Admin: http://localhost:3002/admin
echo.
echo Nhแบฅn Enter ฤแป mแป phpMyAdmin...
pause

start http://localhost/phpmyadmin

echo.
echo ๐ Setup hoรn tแบฅt! Chรบc bแบกn thรnh cรดng!
echo.
pause
